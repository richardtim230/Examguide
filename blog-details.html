<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog Details | ExamGuard Nigeria Blog</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2282/2282759.png">
  <style>
    html { scroll-behavior: smooth; }
    .section-title, h2 {
      font-size: 2.3rem !important;
      font-weight: 900 !important;
      line-height: 1.1;
      letter-spacing: -1px;
      color: #1e3a8a;
      margin-bottom: 2rem;
    }
    @media (max-width: 640px) {
      .section-title, h2 { font-size: 1.5rem !important; }
    }
    .navbar-spacer { height: 74px; }
    @media (min-width: 640px) {
      .navbar-spacer { height: 88px; }
    }
    .blog-content p { margin-bottom: 1.2em; line-height: 1.85; font-size: 1.11rem; color: #223052;}
    .blog-content h2, .blog-content h3 { margin-top: 2em; margin-bottom: 1em; font-weight: bold; color: #1e3a8a; font-size: 1.32rem; }
    .blog-content ul, .blog-content ol { margin-left: 1.5em; margin-bottom: 1.2em; }
    .blog-content li { margin-bottom: 0.7em; line-height: 1.7; font-size: 1.06rem; }
    .blog-content strong { color: #2563eb; }
    .blog-content { padding-top: 0.2em; padding-bottom: 0.2em; }
    @media (max-width: 640px) {
      .blog-content p, .blog-content li { font-size: 1rem; }
      .blog-content h2, .blog-content h3 { font-size: 1.07rem; }
    }
    .accent-bar {
      height: 6px;
      width: 68px;
      border-radius: 9999px;
      background: linear-gradient(90deg,#2563eb 60%,#22d3ee 100%);
      margin-bottom: 20px;
    }
    @media (max-width: 640px) {
      #related-blogs {
        display: flex !important;
        overflow-x: auto;
        gap: 14px;
        padding-bottom: 2px;
        scroll-snap-type: x mandatory;
      }
      #related-blogs > div {
        min-width: 70vw;
        scroll-snap-align: start;
      }
    }
    .comment-bubble {
      background: #fffdfa;
      border-radius: 0.8em;
      padding: 1em 1.2em;
      margin-bottom: 1.5em;
      box-shadow: 0 1px 5px 0 rgb(0 0 0 / 7%);
      border: 1px solid #f3e8ff;
      transition: box-shadow 0.2s;
      position: relative;
    }
    .comment-bubble:hover {
      box-shadow: 0 4px 20px 0 rgb(190 180 255 / 13%);
    }
    .comment-author { font-weight: 600; color: #263159; }
    .comment-date { color: #9ca3af; font-size: 0.92em; }
    .comment-actions { margin-top: 0.4em; display: flex; gap: 1.2em; align-items: center; }
    .like-btn, .reply-btn {
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
      color: #b49b2d;
      border: none;
      background: none;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.25em;
      font-size: 0.97em;
    }
    .like-btn.liked { color: #facc15; }
    .reply-btn.active { color: #263159; }
    .replies-container { margin-left: 1.5em; border-left: 2px solid #facc15; padding-left: 1em; margin-top: 1em; }
    .reply-form { background: #f9fafb; border-radius: 0.5em; padding: 0.9em 1em 0.7em 1em; border: 1px solid #e0e7ff; margin-top: 0.6em; }
    .reply-form input, .reply-form textarea { margin-bottom: 0.7em; }
    @media (max-width: 640px) {
      .replies-container { margin-left: 0.7em; padding-left: 0.5em; }
    }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .related-img { width: 100% !important; object-fit: contain !important; aspect-ratio: 2.7/1 !important; height: 135px !important; }
  </style>
</head>
<body class="bg-blue-50 text-blue-900">

  <!-- Navbar -->
  <nav class="bg-white/95 border-b border-blue-100 fixed w-full z-30 top-0 left-0 shadow-sm">
    <div class="container mx-auto flex flex-wrap items-center justify-between px-4 py-4 md:py-6">
      <a href="index.html" class="flex items-center gap-3">
        <img src="logo.png" class="h-10 md:h-12" alt="ExamGuard Logo">
        <span class="text-2xl md:text-3xl font-bold text-blue-700 tracking-tight leading-tight">ExamGuard<br><span class="block md:inline">Nigeria</span></span>
      </a>
      <button data-collapse-toggle="navbar-default" type="button" class="md:hidden ml-auto p-2 rounded-lg text-blue-800 hover:bg-blue-50 focus:outline-none" aria-controls="navbar-default">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 8h16M4 16h16"></path></svg>
      </button>
      <div class="hidden w-full md:flex md:items-center md:w-auto" id="navbar-default">
        <ul class="flex flex-col md:flex-row md:space-x-8 mt-4 md:mt-0 font-medium">
          <li><a href="index.html#features" class="block py-2 px-3 hover:text-blue-600 transition">Features</a></li>
          <li><a href="index.html#mock-exams" class="block py-2 px-3 hover:text-blue-600 transition">Mock Exams</a></li>
          <li><a href="index.html#codecxi" class="block py-2 px-3 hover:text-blue-600 transition">CODECX Institute</a></li>
          <li><a href="index.html#marketplace" class="block py-2 px-3 hover:text-blue-600 transition">Marketplace</a></li>
          <li><a href="ngg-blog.html" class="block py-2 px-3 hover:text-blue-600 transition font-bold text-blue-700">Blog & Earn</a></li>
          <li><a href="index.html#contact" class="block py-2 px-3 hover:text-blue-600 transition">Contact</a></li>
        </ul>
        <div class="flex space-x-2 mt-4 md:mt-0 md:ml-6">
          <a href="index.html#login" class="px-4 py-2 border border-blue-700 text-blue-700 rounded-lg hover:bg-blue-700 hover:text-white transition font-semibold">Login</a>
          <a href="index.html#register" class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-900 transition font-semibold">Register</a>
        </div>
      </div>
    </div>
  </nav>
  <div class="navbar-spacer"></div>

  <!-- Blog Single Main Section -->
  <section class="w-full px-2 sm:px-0 py-8">
    <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden border border-blue-100">
      <div class="accent-bar mx-8 mt-8"></div>
      <div class="px-6 py-6 sm:px-12 sm:py-10">
        <div id="blog-meta"></div>
        <h1 id="blog-title" class="text-left text-2xl sm:text-3xl font-extrabold text-blue-900 mb-3 leading-tight"></h1>
        <div id="blog-author-date" class="flex flex-wrap items-center gap-3 mb-5 text-[0.93rem] text-blue-900/70"></div>
        <img id="blog-image" class="rounded-xl shadow-md w-full h-56 sm:h-72 object-cover mb-7 border border-blue-100" alt="Blog Cover" />
        <article id="blog-content" class="blog-content w-full pt-2 max-w-none text-[1.12rem] leading-relaxed text-left"></article>
        <div id="blog-tags" class="flex flex-wrap gap-3 mt-8"></div>
      </div>
      <!-- Comments Section -->
      <div class="px-6 py-8 border-t border-blue-100">
        <h2 class="text-xl font-bold text-blue-900 mb-4">Comments</h2>
        <form id="commentForm" class="flex flex-col sm:flex-row gap-2 mb-6">
          <input type="text" id="commentName" placeholder="Your name" required class="sm:w-1/4 px-3 py-2 border rounded focus:ring-2 focus:ring-yellow-400"/>
          <input type="text" id="commentText" placeholder="Add a comment..." required class="flex-1 px-3 py-2 border rounded focus:ring-2 focus:ring-yellow-400"/>
          <button type="submit" class="bg-yellow-500 text-blue-900 px-5 py-2 rounded font-bold hover:bg-blue-900 hover:text-yellow-400 transition">Comment</button>
        </form>
        <div id="commentsList"></div>
      </div>
    </div>
  </section>

  <!-- Related Posts -->
  <section class="container mx-auto px-2 sm:px-4 py-10">
    <h2 class="section-title text-center">Related Articles</h2>
    <div id="related-blogs" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-5xl mx-auto"></div>
  </section>
  <!-- Footer -->
<footer class="bg-white border-t border-blue-100 py-8 mt-10">
    <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
      <div class="text-blue-900/80 mb-2">&copy; 2025 ExamGuard Nigeria. All rights reserved.</div>
      <div class="flex space-x-4 text-blue-700">
        <a href="#" class="hover:underline">Privacy Policy</a>
        <a href="#" class="hover:underline">Terms of Service</a>
      </div>
      <div class="flex space-x-2">
        <a href="#" aria-label="Twitter" class="text-blue-400 hover:text-blue-700">
          <svg fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.59-2.47.7a4.15 4.15 0 001.82-2.29c-.78.46-1.67.8-2.6.98A4.14 4.14 0 0016.11 4c-2.3 0-4.16 1.86-4.16 4.15 0 .32.04.65.1.96C7.69 8.95 4.07 7.13 1.64 4.15c-.35.6-.56 1.3-.56 2.07 0 1.43.73 2.68 1.84 3.41a4.08 4.08 0 01-1.89-.52v.05c0 2 1.43 3.68 3.32 4.06a4.2 4.2 0 01-1.88.07 4.16 4.16 0 003.89 2.89A8.34 8.34 0 012 19.54c-.54 0-1.07-.03-1.6-.1A11.74 11.74 0 006.29 21c7.55 0 11.68-6.26 11.68-11.69 0-.18-.01-.35-.02-.53A8.4 8.4 0 0024 4.59a8.18 8.18 0 01-2.36.65 4.13 4.13 0 001.82-2.29"></path></svg>
        </a>
        <a href="#" aria-label="Facebook" class="text-blue-600 hover:text-blue-900">
          <svg fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.675 0h-21.35C.592 0 0 .592 0 1.326v21.348C0 23.408.592 24 1.326 24H12.82v-9.294H9.692V11.01h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.92.001c-1.504 0-1.797.715-1.797 1.763v2.312h3.587l-.467 3.696h-3.12V24h6.116A1.326 1.326 0 0024 22.674V1.326A1.326 1.326 0 0022.675 0"></path></svg>
        </a>
        <a href="#" aria-label="Instagram" class="text-pink-500 hover:text-pink-800">
          <svg fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.34 3.608 1.316.976.976 1.254 2.243 1.316 3.608.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.062 1.366-.34 2.633-1.316 3.608-.976.976-2.243 1.254-3.608 1.316-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.366-.062-2.633-.34-3.608-1.316-.976-.976-1.254-2.243-1.316-3.608C2.175 15.646 2.163 15.266 2.163 12s.012-3.584.07-4.85c.062-1.366.34-2.633 1.316-3.608.976-.976 2.243-1.254 3.608-1.316C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.741 0 8.332.013 7.052.072 5.771.13 4.77.388 3.92 1.238c-.849.849-1.107 1.85-1.165 3.13C2.013 8.332 2 8.741 2 12s.013 3.668.072 4.948c.058 1.28.316 2.281 1.165 3.13.849.849 1.85 1.107 3.13 1.165C8.332 23.987 8.741 24 12 24s3.668-.013 4.948-.072c1.28-.058 2.281-.316 3.13-1.165.849-.849 1.107-1.85 1.165-3.13.059-1.28.072-1.689.072-4.948s-.013-3.668-.072-4.948c-.058-1.28-.316-2.281-1.165-3.13-.849-.849-1.85-1.107-3.13-1.165C15.668.013 15.259 0 12 0zm0 5.838A6.162 6.162 0 005.838 12 6.162 6.162 0 0012 18.162 6.162 6.162 0 0018.162 12 6.162 6.162 0 0012 5.838zm0 10.162A3.838 3.838 0 118.162 12 3.838 3.838 0 0112 16zm6.406-11.845a1.44 1.44 0 11-2.88 0 1.44 1.44 0 012.88 0z"></path></svg>
        </a>
      </div>
    </div>
  </footer>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Navbar responsive toggle
      const btn = document.querySelector('[data-collapse-toggle]');
      const menu = document.getElementById('navbar-default');
      btn?.addEventListener('click', () => {
        menu.classList.toggle('hidden');
      });

      // Get post id from URL
      function getPostIdFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
      }

      // Fetch all blogs for details and related
      const API_URL = "https://examguide.onrender.com/api/blogger-dashboard/allposts";
      const USER_API = "https://examguide.onrender.com/api/users/";
      let allPosts = [];

      async function fetchAllBlogs() {
        const res = await fetch(API_URL);
        if (!res.ok) return [];
        const data = await res.json();
        return data;
      }

      async function fetchAuthor(userId) {
        if (!userId) return {};
        try {
          const resp = await fetch(USER_API + userId);
          if (!resp.ok) return {};
          const d = await resp.json();
          return d.user || {};
        } catch {
          return {};
        }
      }

      function sanitizeHTML(html) {
        return typeof html === "string"
          ? html.replace(/<\/script>/gi, "&lt;/script&gt;").replace(/<script/gi, "&lt;script")
          : html;
      }

      function renderComments(comments) {
        const commentsDiv = document.getElementById('commentsList');
        commentsDiv.innerHTML = '';
        if (!Array.isArray(comments) || comments.length === 0) {
          commentsDiv.innerHTML = `<div class="text-gray-400 italic">No comments yet. Be the first to comment!</div>`;
          return;
        }
        comments.forEach(comment => {
          const commentElement = document.createElement('div');
          commentElement.className = 'comment-bubble';
          commentElement.innerHTML = `
            <span class="comment-author">${comment.name || 'Anonymous'}</span>
            <span class="comment-date ml-2">${comment.date ? new Date(comment.date).toLocaleString() : ''}</span>
            <div class="mt-1 text-gray-800">${comment.text}</div>
          `;
          commentsDiv.appendChild(commentElement);
        });
      }

      async function main() {
        allPosts = await fetchAllBlogs();
        const postId = getPostIdFromURL() || (window.localStorage.getItem('selectedBlogId') || "");
        let mainPost = allPosts.find(p => (String(p._id) === String(postId) || String(p.id) === String(postId)));
        if (!mainPost) {
          // fallback to localStorage (from legacy/old navigation)
          let blogDataRaw = localStorage.getItem('selectedBlogData');
          if (blogDataRaw) {
            try { mainPost = JSON.parse(blogDataRaw); } catch {}
          }
        }
        if (!mainPost) {
          document.getElementById('blog-title').innerText = 'Blog not found';
          document.getElementById('blog-content').innerHTML = "<p>Sorry, this blog post could not be loaded.</p>";
          document.getElementById('blog-image').src = "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=800&q=80";
          return;
        }
        // Author Info
        let authorName = mainPost.authorName || mainPost.author || "Anonymous";
        let authorBio = "";
        let authorAvatar = "https://ui-avatars.com/api/?name=" + encodeURIComponent(authorName) + "&background=FFCE45&color=263159&rounded=true";
        if (mainPost.authorId || mainPost.user) {
          const authorData = await fetchAuthor(mainPost.authorId || mainPost.user);
          if (authorData && (authorData.fullname || authorData.username)) {
            authorName = authorData.fullname || authorData.username;
            authorBio = authorData.bio || "";
            authorAvatar = authorData.profilePic
              ? (authorData.profilePic.startsWith("http") ? authorData.profilePic : authorData.profilePic)
              : authorAvatar;
          }
        }
        // Meta & title
        document.getElementById('blog-meta').innerHTML = `
          <div class="flex flex-wrap items-center mb-5 gap-2">
            ${mainPost.university ? `<span class="bg-blue-100 text-blue-700 text-xs font-semibold px-3 py-1 rounded">${mainPost.university}</span>` : ""}
            ${mainPost.category ? `<span class="bg-gray-100 text-blue-900 text-xs font-semibold px-3 py-1 rounded">${mainPost.category}</span>` : ""}
            <span class="inline-flex items-center gap-1 text-yellow-500 text-sm font-semibold ml-auto">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.957a1 1 0 00.95.69h4.159c.969 0 1.371 1.24.588 1.81l-3.37 2.448a1 1 0 00-.364 1.118l1.287 3.957c.3.921-.755 1.688-1.539 1.118l-[...]
              </svg>
              ${(mainPost.rating !== undefined && mainPost.rating !== null) ? mainPost.rating : '0.0'}
            </span>
          </div>
        `;
        document.getElementById('blog-title').innerText = mainPost.title || "Untitled";
        document.getElementById('blog-author-date').innerHTML = `
          <span>By <strong>${authorName}</strong></span>
          <span>·</span>
          <span>Published: ${mainPost.date ? new Date(mainPost.date).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' }) : "Unknown date"}</span>
          <span>·</span>
          <span>${mainPost.reads || 0} reads</span>
        `;
        document.getElementById('blog-image').src = mainPost.images || mainPost.imageUrl || mainPost.image || "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=800&q=80";
        document.getElementById('blog-content').innerHTML = sanitizeHTML(mainPost.content || mainPost.summary || "<p>No content available.</p>");
        const tagsDiv = document.getElementById('blog-tags');
        if (Array.isArray(mainPost.tags)) {
          tagsDiv.innerHTML = mainPost.tags.map(tag =>
            `<span class="bg-blue-100 text-blue-700 rounded-full px-4 py-1 text-xs font-semibold">#${tag}</span>`
          ).join("");
        } else {
          tagsDiv.innerHTML = "";
        }
        // Comments
        renderComments(mainPost.comments || []);
        // Comment submit
        document.getElementById('commentForm').onsubmit = function(e) {
          e.preventDefault();
          const name = document.getElementById('commentName').value.trim() || "Anonymous";
          const text = document.getElementById('commentText').value.trim();
          if (!text) return;
          let arr = mainPost.comments || [];
          arr = arr.concat([{
            name,
            text,
            date: new Date().toISOString()
          }]);
          mainPost.comments = arr;
          renderComments(arr);
          this.reset();
        };
        // Related posts: same category, exclude self
        let related = allPosts.filter(p =>
          (p._id || p.id) !== (mainPost._id || mainPost.id) &&
          (p.category === mainPost.category)
        );
        if (related.length < 2) {
          related = allPosts.filter(p => (p._id || p.id) !== (mainPost._id || mainPost.id)).slice(0, 4);
        } else {
          related = related.slice(0, 4);
        }
        const relatedDiv = document.getElementById('related-blogs');
        relatedDiv.innerHTML = '';
        related.forEach(blog => {
          const div = document.createElement('div');
          div.className = 'bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition duration-200 flex flex-col border border-blue-100 cursor-pointer';
          div.innerHTML = `
            <img src="${blog.images || blog.imageUrl || blog.image || 'https://images.unsplash.com/photo-1510936111840-6c2d098e3c49?auto=format&fit=crop&w=600&q=80'}"
              alt="${blog.title}" class="w-full h-36 object-cover border-b border-blue-50">
            <div class="p-5 flex flex-col flex-1">
              <div class="flex items-center gap-2 mb-2">
                ${blog.university ? `<span class="bg-purple-100 text-purple-700 text-xs font-semibold px-2 py-1 rounded">${blog.university}</span>` : ""}
                ${blog.category ? `<span class="bg-gray-100 text-blue-900 text-xs font-semibold px-2 py-1 rounded">${blog.category}</span>` : ""}
              </div>
              <h3 class="font-bold text-lg mb-1 text-blue-900">${blog.title}</h3>
              <a href="blog-single.html?id=${blog._id || blog.id}" class="text-blue-700 font-semibold mt-auto hover:underline">Read More</a>
            </div>
          `;
          div.onclick = () => {
            window.location.href = `blog-single.html?id=${blog._id || blog.id}`;
          };
          relatedDiv.appendChild(div);
        });
      }
      main();
    });
  </script>
</body>
</html>
