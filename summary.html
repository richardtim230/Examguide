<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.95"/>
  <title>Exam Summary</title>
    <!-- Google Fonts for Dancing Script -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', 'Tahoma', Geneva, Verdana, sans-serif;
      background: #0B0B45;
      color: #fff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: linear-gradient(-45deg, #0072ff, #00c6ff, #5e60ce, #f72585);
      background-size: 400% 400%;
      animation: gradientBG 12s ease infinite;
      color: #fff;
      box-shadow: 0 4px 32px 0 #00c6ff44, 0 1.5px 0 #fff2;
      position: relative;
      padding: 36px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    header .logo-row {
      display: flex;
      align-items: center;
      gap: 18px;
      justify-content: center;
    }
    header img {
      height: 62px;
      border-radius: 12px;
      background: #fff;
      padding: 6px;
      box-shadow: 0 2px 8px rgba(0,198,255,0.20);
    }
    header .main-title {
      font-size: 2.0rem;
      font-weight: bold;
      letter-spacing: 1.5px;
    }
    header .subtitle {
      font-size: 1.1rem;
      opacity: 0.92;
      margin-top: 5px;
      font-weight: 400;
    }
    .summary-container {
      max-width: 950px;
      margin: 32px auto 32px auto;
      background: rgba(255,255,255,0.09);
      border-radius: 14px;
      padding: 30px 22px 24px 22px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.13);
      flex: 1 0 auto;
    }
    .section-title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #00c6ff;
      letter-spacing: 0.5px;
      margin-top: 24px;
      text-align: center;
    }
    .details-table-container {
      margin-bottom: 32px;
      overflow-x: auto;
    }
    table.details-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0;
      background: rgba(255,255,255,0.11);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 14px;
      box-shadow: 0 2px 10px rgba(0,198,255,0.04);
    }
    .details-table th, .details-table td {
      padding: 14px 12px;
      text-align: left;
      font-size: 15px;
      border-bottom: 1.2px solid rgba(0,198,255,0.12);
    }
    .details-table th {
      background: rgba(0,198,255,0.17);
      color: #00c6ff;
      font-weight: bold;
      width: 220px;
    }
    .details-table tr:last-child td {
      border-bottom: none;
    }
    .score {
      font-size: 20px;
      font-weight: bold;
      color: #00ffae;
    }
    .attempted {
      color: #ffc107;
      font-weight: bold;
    }
    .percentage {
      color: #00c6ff;
      font-size: 17px;
      font-weight: bold;
    }
    .pie-chart-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 36px;
      width: 100%;
      padding: 24px 0;
      box-sizing: border-box;
    }
    .pie-chart-section canvas {
      display: block;
      margin: 16px auto 0 auto;
      background: rgba(255,255,255,0.10);
      border-radius: 50%;
      box-shadow: 0 2px 12px rgba(0,198,255,0.10);
      max-width: 320px;
      width: 100%;
      height: auto;
    }
    .question-review {
      background: rgba(255,255,255,0.13);
      margin: 18px 0 26px 0;
      padding: 16px 16px 12px 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .question-review .question {
      font-size: 17px;
      font-weight: bold;
      margin-bottom: 7px;
    }
    .question-review img {
      max-width: 70%;
      border-radius: 8px;
      margin: 8px 0;
    }
    .option-block {
      margin: 4px 0 4px 0;
    }
    .option-block .label {
      display: inline-block;
      width: 120px;
      font-weight: bold;
      color: #00c6ff;
    }
    .user-answer.correct {
      background: #00ffae22;
      color: #00ffae;
      border-radius: 5px;
      padding: 3px 8px;
      font-weight: 600;
    }
    .user-answer.incorrect {
      background: #ff4e5522;
      color: #ff4e55;
      border-radius: 5px;
      padding: 3px 8px;
      font-weight: 600;
    }
    .correct-answer {
      background: #00c6ff22;
      color: #00c6ff;
      border-radius: 5px;
      padding: 3px 8px;
      font-weight: 600;
    }
    .explanation {
      margin-top: 7px;
      background: rgba(0,198,255,0.08);
      color: #bdeaff;
      border-left: 4px solid #00c6ff;
      padding: 7px 12px;
      border-radius: 6px;
      font-size: 15px;
    }
    
    .footer-glass {
      background: rgba(22,34,65,0.82);
      box-shadow: 0 -8px 42px 0 #00c6ff66, 0 -1.5px 0 #fff2;
      backdrop-filter: blur(9px);
      border-top-left-radius: 36px;
      border-top-right-radius: 36px;
      overflow: hidden;
      position: relative;
      z-index: 1;
      padding: 44px 0 48px 0;
      margin-top: 38px;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Segoe UI', 'Tahoma', Geneva, Verdana, sans-serif;
    }
    .footer-content-cool {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    .footer-powered-cool {
      font-size: 1.13rem;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      background: rgba(0, 198, 255, 0.10);
      padding: 8px 24px;
      border-radius: 9px;
      margin: 0 auto;
      box-shadow: 0 1.5px 6px rgba(0,198,255,0.10);
    }
    .footer-divider-cool {
      width: 60%;
      height: 2.5px;
      background: linear-gradient(90deg, #00c6ff 0%, #f72585 100%);
      border: none;
      border-radius: 2px;
      margin: 12px 0 8px 0;
      opacity: 0.7;
      box-shadow: 0 0 8px 0 #00c6ff44;
    }
    .footer-honour-cool {
      margin-top: 10px;
      font-family: 'Dancing Script', cursive, 'Segoe UI', sans-serif;
      font-size: 1.38rem;
      font-weight: bold;
      letter-spacing: 0.7px;
      background: linear-gradient(90deg, #00c6ff 0%, #f72585 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: brightness(1.25);
      text-shadow: 0 2px 18px #00c6ff99, 1px 1px 0 #f7258577;
      padding: 6px 20px;
      border-radius: 24px;
      border: 2.5px solid #00c6ff66;
      box-shadow: 0 2px 18px #00c6ff33;
      position: relative;
      display: inline-block;
      animation: fadeInHonour 1.8s ease;
    }
    @keyframes fadeInHonour {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .footer-badge {
      position: absolute;
      top: -22px;
      right: 12px;
      background: #f72585;
      color: #fff;
      font-size: 1.05em;
      padding: 3px 15px 3px 12px;
      border-radius: 18px;
      font-family: 'Segoe UI', sans-serif;
      font-weight: 600;
      box-shadow: 0 2px 10px #f7258544;
      transform: rotate(8deg);
      letter-spacing: 0.5px;
      border: 1.5px solid #fff;
      z-index: 10;
      animation: fadeInBadge 2.4s 0.4s backwards;
    }
    @keyframes fadeInBadge {
      from {opacity: 0; transform: scale(0.8);}
      to {opacity: 1; transform: scale(1);}
    }
    .footer-socials {
      display: flex;
      gap: 15px;
      margin-top: 12px;
    }
    .footer-socials a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: rgba(0,198,255,0.13);
      color: #fff;
      font-size: 1.45em;
      transition: background 0.2s, box-shadow 0.2s, color 0.2s;
      box-shadow: 0 2px 6px rgba(0,198,255,0.07);
      text-decoration: none;
    }
    .footer-socials a:hover {
      background: linear-gradient(90deg, #00c6ff 0%, #f72585 100%);
      color: #fffbe7;
      box-shadow: 0 2px 12px #00c6ff33;
    }
    /* Sparkle animation */
    .sparkle {
      position: absolute;
      pointer-events: none;
      opacity: 0.7;
      animation: sparkle-anim 4s linear infinite;
    }
    .sparkle.s1 { top: 10%; left: 11%; font-size: 1em; animation-delay: 0s;}
    .sparkle.s2 { top: 18%; right: 17%; font-size: 1.5em; animation-delay: 1.2s;}
    .sparkle.s3 { bottom: 14%; left: 18%; font-size: 1.2em; animation-delay: 2.1s;}
    .sparkle.s4 { bottom: 20%; right: 13%; font-size: 1.7em; animation-delay: 0.7s;}
    @keyframes sparkle-anim {
      0% { opacity: 0.7; transform: scale(1);}
      50% { opacity: 1; transform: scale(1.3) rotate(18deg);}
      100% { opacity: 0.7; transform: scale(1);}
    }
  

  
    #printBtn {
      background: #fff;
      color: #0072ff;
      border: none;
      border-radius: 7px;
      font-size: 16px;
      font-weight: bold;
      padding: 13px 28px;
      cursor: pointer;
      margin: 0 auto 18px auto;
      display: block;
      transition: background 0.2s, color 0.2s;
      box-shadow: 0 2px 8px rgba(0,198,255,0.09);
    }
    #printBtn:hover {
      background: #00c6ff;
      color: #fff;
    }
    @keyframes gradientBG {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');
    @media (max-width: 800px) {
      .summary-container {
        padding: 12px 5px;
      }
      .details-table th, .details-table td {
        font-size: 13px;
        padding: 10px 6px;
      }
      .section-title {
        font-size: 17px;
      }
      header .main-title {
        font-size: 1.4rem;
      }
      header img {
        height: 40px;
      }
      .pie-chart-section {
        padding: 12px 0;
      }
      footer {
        font-size: 1.00rem;
        padding: 28px 0 29px 0;
        border-top-left-radius: 22px;
        border-top-right-radius: 22px;
      }
      .footer-content {
        gap: 10px;
      }
      .footer-powered {
        font-size: 1.01rem;
        padding: 5px 10px;
      }
      .footer-divider {
        width: 80%;
        height: 2px;
        margin: 10px 0 4px 0;
      }
      .footer-honour {
        font-size: 1.07rem;
        padding: 2px 3px;
      }
    }
    @media print {
      #printBtn, footer {
        display: none !important;
      }
      body, .summary-container, header {
        background: #fff !important;
        color: #000 !important;
        box-shadow: none !important;
      }
      .pie-chart-section canvas, .question-review, .details-table, header img {
        background: #fff !important;
      }
      header {
        color: #000 !important;
        box-shadow: none !important;
      }
      .correct-answer, .user-answer.correct, .user-answer.incorrect {
        color: #000 !important;
        background: #eee !important;
      }
      .explanation {
        background: #f7faff !important;
        color: #222 !important;
        border-left: 4px solid #00c6ff !important;
      }
    }
  </style>
  <!-- MathJax -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Dancing Script Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="logo-row">
      <img src="logo.png" alt="Logo">
      <div>
        <div class="main-title">Test Summary Report</div>
        <div class="subtitle">Review your performance and answers below</div>
      </div>
    </div>
  </header>
  <div class="summary-container">
    <div class="section-title">Details</div>
    <div class="details-table-container">
      <table class="details-table" id="detailsTable">
        <!-- filled by JS -->
      </table>
    </div>
    <div class="pie-chart-section">
      <div style="font-size: 18px; color: #00c6ff; font-weight: bold; text-align:center;">Result Pie Chart</div>
      <canvas id="resultPieChart" width="280" height="280"></canvas>
    </div>
    <div class="section-title">Attempt Review</div>
    <div id="reviewSection"></div>
  </div>
  <footer>
    <div class="footer-glass">
    <span class="sparkle s1">✨</span>
    <span class="sparkle s2">🌟</span>
    <span class="sparkle s3">💫</span>
    <span class="sparkle s4">⭐</span>
    <div class="footer-content-cool">
      <button id="printBtn">Print / Save as PDF</button>
      <div class="footer-powered-cool">
        &copy; <span id="year"></span> <strong>CBT Platform</strong> &mdash; Powered by ExamGuide
      </div>
      <hr class="footer-divider-cool"/>
      <div class="footer-honour-cool" style="position:relative;">
        This solutions were provided and reviewed by
        <span class="footer-badge">Hon. Richard D'prof</span>
      </div>
      <div class="footer-socials">
        <a href="#" aria-label="WhatsApp"><span>🟢</span></a>
        <a href="#" aria-label="LinkedIn"><span>🔗</span></a>
        <a href="#" aria-label="Email"><span>✉️</span></a>
      </div>
    </div>
  </div>
  </footer>
  <script>
    // Data and calculations
    const currentUser = localStorage.getItem('current_user') || 'Guest';
    const answers = JSON.parse(localStorage.getItem(`answers_${currentUser}`) || '{}');
    const questions = JSON.parse(localStorage.getItem(`questions_${currentUser}`) || '[]');
    const timeTaken = Number(localStorage.getItem(`timeTaken_${currentUser}`) || "0");

    const totalQuestions = questions.length;
    const attemptedQuestions = Object.keys(answers).length;
    let score = 0;
// Prevent unauthorized access
if (!currentUser || currentUser === "Guest") {
  // Redirect to login page (adjust the path as needed)
  window.location.href = "mock.html";
}
    questions.forEach(q => {
      if (answers[q.id] !== undefined && typeof answers[q.id] !== 'undefined' && answers[q.id] === q.answer) score++;
    });

    const incorrect = attemptedQuestions - score;
    const notAttempted = totalQuestions - attemptedQuestions;
    const percentage = totalQuestions ? (score / totalQuestions * 100).toFixed(2) : 0;
    const avgSpeed = totalQuestions ? (timeTaken / totalQuestions).toFixed(2) : 0;
    const mins = Math.floor(timeTaken / 60);
    const secs = timeTaken % 60;

    // Fill Table
    document.getElementById('detailsTable').innerHTML = `
      <tr>
        <th>Username</th>
        <td>${currentUser}</td>
      </tr>
      <tr>
        <th>Total Questions</th>
        <td>${totalQuestions}</td>
      </tr>
      <tr>
        <th>Attempted</th>
        <td class="attempted">${attemptedQuestions}</td>
      </tr>
      <tr>
        <th>Correct Answers</th>
        <td class="score">${score}</td>
      </tr>
      <tr>
        <th>Incorrect Answers</th>
        <td style="color:#ff4e55; font-weight:bold;">${incorrect}</td>
      </tr>
      <tr>
        <th>Not Attempted</th>
        <td style="color:#bdeaff; font-weight:bold;">${notAttempted}</td>
      </tr>
      <tr>
        <th>Percentage</th>
        <td class="percentage">${percentage}%</td>
      </tr>
      <tr>
        <th>Avg Speed</th>
        <td>${avgSpeed} sec/question</td>
      </tr>
      <tr>
        <th>Time Taken</th>
        <td>${mins}m ${secs < 10 ? '0' : ''}${secs}s</td>
      </tr>
    `;

    // Pie Chart
    window.addEventListener('DOMContentLoaded', function() {
      const ctx = document.getElementById('resultPieChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Correct', 'Incorrect', 'Not Attempted'],
          datasets: [{
            data: [score, incorrect, notAttempted],
            backgroundColor: [
              '#00ffae', // Correct
              '#ff4e55', // Incorrect
              '#bdeaff'  // Not Attempted
            ],
            borderWidth: 2,
            borderColor: '#232526'
          }]
        },
        options: {
          responsive: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: '#fff',
                font: {size: 15}
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += context.parsed;
                  return label;
                }
              }
            }
          }
        }
      });
    });

    // Attempt Review
    function renderReview() {
      let html = '';
      questions.forEach((q, idx) => {
        const userAns = answers[q.id];
        const isCorrect = userAns === q.answer;
        const questionImage = q.questionImage ? `<img src="${q.questionImage}" alt="Question Image" />` : '';
        html += `
          <div class="question-review">
            <div class="question">${idx + 1}. ${q.question}</div>
            ${questionImage}
            <div class="option-block">
              <span class="label">Your Answer:</span>
              <span class="user-answer ${typeof userAns === "undefined" ? "" : (isCorrect ? 'correct' : 'incorrect')}">
                ${typeof userAns === "undefined" ? "<em>Not answered</em>" : userAns}
              </span>
            </div>
            <div class="option-block">
              <span class="label">Correct Answer:</span>
              <span class="correct-answer">${q.answer}</span>
            </div>
            <div class="explanation">
              <strong>Explanation:</strong> <br/>
              ${q.explanation}
            </div>
          </div>
        `;
      });
      document.getElementById('reviewSection').innerHTML = html;
      if (window.MathJax && window.MathJax.typesetPromise) {
        MathJax.typesetPromise();
      }
    }
    renderReview();

    // Footer year
  
    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('printBtn').onclick = function() {
      window.print();
    };
  
  </script>
</body>
</html>
