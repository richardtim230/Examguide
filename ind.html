<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ExamGuard Nigeria | Mock Exams, Marketplace, Blog & Campus Tools</title>
<meta name="description" content="ExamGuard Nigeria: Practice mock exams, access past questions, join the student marketplace, and share your story. Adaptive learning, secure platform, and campus blog.">
<meta name="keywords" content="ExamGuard, Nigeria, mock exams, past questions, student marketplace, campus blog, adaptive learning, student portal, university, academics, OAU, UNILAG, UNIBEN, UI, ABU">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<link rel="canonical" href="https://examguard.com.ng/" />

<!-- Open Graph tags (Facebook, WhatsApp) -->
<meta property="og:site_name" content="ExamGuard Nigeria" />
<meta property="og:title" content="ExamGuard Nigeria | Mock Exams, Marketplace, Blog & Campus Tools" />
<meta property="og:description" content="Practice mock exams, access past questions, join the campus marketplace, and share your story on ExamGuard Nigeria. Built for students, by students." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://examguard.com.ng/" />
<meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/2282/2282759.png" />
<meta property="og:image:alt" content="ExamGuard Nigeria Logo" />
<meta property="og:locale" content="en_NG" />
<meta property="og:image:width" content="512" />
<meta property="og:image:height" content="512" />

<!-- Twitter Card tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@ExamGuardNG" />
<meta name="twitter:creator" content="@ExamGuardNG" />
<meta name="twitter:title" content="ExamGuard Nigeria | Mock Exams, Marketplace, Blog & Campus Tools" />
<meta name="twitter:description" content="Join ExamGuard Nigeria for mock exams, past questions, blogging, and campus marketplace. All-in-one for Nigerian students." />
<meta name="twitter:image" content="https://cdn-icons-png.flaticon.com/512/2282/2282759.png" />
<meta name="twitter:image:alt" content="ExamGuard Nigeria Logo" />

<!-- Favicon and Apple Touch Icon -->
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2282/2282759.png" sizes="32x32"/>
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2282/2282759.png" />

<!-- Mobile & Theme -->
<meta name="theme-color" content="#1e3a8a" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- SEO Breadcrumbs -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://examguard.com.ng/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Features",
      "item": "https://examguard.com.ng/#features"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Marketplace",
      "item": "https://examguard.com.ng/#marketplace"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Blog & Earn",
      "item": "https://examguard.com.ng/#blog"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "ExamGuard Nigeria",
  "url": "https://examguard.com.ng/",
  "logo": "https://cdn-icons-png.flaticon.com/512/2282/2282759.png",
  "sameAs": [
    "https://twitter.com/ExamGuardNG",
    "https://facebook.com/ExamGuardNG",
    "https://instagram.com/ExamGuardNG"
  ],
  "description": "ExamGuard Nigeria is the ultimate portal for mock exams, study resources, blogging, and student marketplace. Secure, private, and built for Nigerian universities."
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "ExamGuard Nigeria",
  "url": "https://examguard.com.ng/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://examguard.com.ng/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2282/2282759.png">
  <style>
    html { scroll-behavior: smooth; }
    .section-title {
      font-size: 2.5rem !important;
      font-weight: 900 !important;
      line-height: 1.1;
      letter-spacing: -1px;
      color: #1e3a8a;
      margin-bottom: 2rem;
    }
    @media (max-width: 640px) {
      .section-title { font-size: 2rem !important; }
    }
    .marketplace-tight { margin-bottom: 0.5rem !important; padding-bottom: 0.5rem !important; }
    .marketplace-items-tight { margin-top: 0.5rem !important; padding-top: 0.5rem !important; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="bg-blue-50 text-blue-900">
  <!-- ...nav and other sections unchanged... -->
  <section id="blog" class="container mx-auto pt-5 px-4 py-20">
    <div class="flex flex-col md:flex-row items-center gap-12">
      <div class="w-full md:w-1/2 text-center md:text-left">
        <h2 class="text-3xl sm:text-4xl font-extrabold text-blue-900 mb-5">Blog & Earn—Share Your Story</h2>
        <p class="mb-6 text-lg text-blue-900/80 font-medium">
          Everyone’s got a story, a hack, or a lesson learned the hard way. Write articles, post insights, or just share memes that help others survive campus life. Earn as you write or read—because your knowledge matters.
        </p>
        <a href="ngg-blog.html" class="inline-block px-7 py-3 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition text-lg">Start Blogging</a>
      </div>
      <div class="w-full md:w-1/2 mb-8 md:mb-0 flex justify-center">
        <img src="https://images.unsplash.com/photo-1517520287167-4bbf64a00d66?auto=format&fit=crop&w=600&q=80" alt="Student Blogging" class="rounded-2xl shadow-lg w-full max-w-md"/>
      </div>
    </div>
    <div id="blogLoader" class="flex items-center justify-center min-h-[120px]" style="display: none;">
      <div style="width: 48px; height: 48px; border: 5px solid #fcd34d; border-top: 5px solid #1e3a8a; border-radius: 50%; animation: spin 0.9s linear infinite;"></div>
      <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
    </div>
    <div id="blogList" class="grid gap-8 grid-cols-1 sm:grid-cols-2 mt-8"></div>
  </section>
  <section id="marketplace" class="bg-blue-50 py-20 px-4 marketplace-tight">
    <!-- ...marketplace hero unchanged... -->
  </section>
  <section class="w-full px-2 sm:px-6 py-10 bg-blue-50 marketplace-items-tight">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-2xl sm:text-3xl font-extrabold text-blue-900 mb-6">MARKETPLACE ITEMS</h2>
      <span id="listingCount" class="text-gray-500 text-sm block mb-4"></span>
      <div id="marketItemsGrid" class="grid gap-8 grid-cols-1 sm:grid-cols-2"></div>
    </div>
  </section>
  <!-- ...rest of the file unchanged... -->
  <script>
    // ...nav/modal code unchanged...

    // BLOG FETCH (oau-blog.html logic)
    const BLOG_API_URL = "https://examguide.onrender.com/api/blogger-dashboard/allposts";
    const BLOG_USER_API = "https://examguide.onrender.com/api/users/";
    let blogPosts = [];
    let authorsCache = {};

    const blogLoader = document.getElementById('blogLoader');
    const blogList = document.getElementById('blogList');
    function showBlogLoader(show = true) {
      blogLoader.style.display = show ? "flex" : "none";
      blogList.style.display = show ? "none" : "grid";
    }

    async function fetchAndRenderBlogs() {
      showBlogLoader(true);
      try {
        const res = await fetch(BLOG_API_URL);
        if (!res.ok) throw new Error("Could not fetch blogs");
        const data = await res.json();
        // Get all unique authorIds
        const authorIds = [...new Set(data.map(post => post.authorId || post.user).filter(Boolean))];
        await Promise.all(authorIds.map(async uid => {
          if (authorsCache[uid]) return;
          try {
            const resp = await fetch(BLOG_USER_API + uid);
            if (!resp.ok) return;
            const d = await resp.json();
            authorsCache[uid] = {
              name: d.user?.fullname || d.user?.username || "Anonymous",
              avatar: d.user?.profilePic
                ? (d.user.profilePic.startsWith("http") ? d.user.profilePic : d.user.profilePic)
                : `https://ui-avatars.com/api/?name=${encodeURIComponent(d.user?.fullname || d.user?.username || "A")}&background=FFCE45&color=263159&rounded=true`
            };
          } catch {}
        }));

        blogPosts = data.map(post => {
          const userId = post.authorId || post.user;
          const authorData = userId && authorsCache[userId] ? authorsCache[userId] : { name: "Anonymous", avatar: "https://ui-avatars.com/api/?name=A&background=FFCE45&color=263159&rounded=true" };
          return {
            id: post._id,
            title: post.title,
            category: post.category || "General",
            author: authorData.name,
            authorAvatar: authorData.avatar,
            date: post.date ? new Date(post.date).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' }) : "",
            image: post.images || "https://images.unsplash.com/photo-1517520287167-4bbf64a00d66?auto=format&fit=crop&w=600&q=80",
            summary: post.content ? post.content.replace(/<[^>]+>/g, '').substring(0, 120) + "..." : "",
            content: post.content || "",
            reads: post.views || 0,
            rating: post.likes ? (Math.min(5, 3 + (post.likes / 20))).toFixed(1) : 4.5,
            comments: Array.isArray(post.comments) ? post.comments.length : 0,
            featured: post.featured || false
          };
        });
        renderBlogs(blogPosts);
      } catch (e) {
        blogList.innerHTML = "<div class='col-span-2 text-center text-gray-500 py-10'>Could not load blog posts.</div>";
      }
      showBlogLoader(false);
    }

    function renderBlogs(posts) {
      if (!blogList) return;
      if (!posts.length) {
        blogList.innerHTML = "<div class='col-span-2 text-center text-gray-500 py-10'>No blog posts found.</div>";
        return;
      }
      blogList.innerHTML = posts.slice(0, 3).map(blog => {
        // Images array logic
        let imagesArr = [];
        if (Array.isArray(blog.image)) {
          imagesArr = blog.image;
        } else if (Array.isArray(blog.images)) {
          imagesArr = blog.images;
        } else if (typeof blog.image === "string" && blog.image.startsWith("data:image")) {
          imagesArr = [blog.image];
        } else if (typeof blog.images === "string" && blog.images.startsWith("data:image")) {
          imagesArr = [blog.images];
        } else if (blog.imageUrl && blog.imageUrl.startsWith("data:image")) {
          imagesArr = [blog.imageUrl];
        } else if (blog.imageUrl) {
          imagesArr = [blog.imageUrl];
        } else if (typeof blog.image === "string" && blog.image) {
          imagesArr = [blog.image];
        }
        if (!imagesArr.length || !imagesArr[0]) {
          imagesArr = ['https://images.unsplash.com/photo-1517520287167-4bbf64a00d66?auto=format&fit=crop&w=600&q=80'];
        }
        return `
        <div class="bg-white rounded-2xl shadow-xl flex flex-col overflow-hidden hover:scale-[1.025] hover:shadow-2xl transition-all duration-200 border border-gray-100 group relative">
          <div class="relative">
            <img 
              src="${imagesArr[0]}" 
              alt="${blog.title}" 
              class="w-full max-h-64 object-contain rounded-lg mb-3 group-hover:scale-105 transition bg-gray-50" 
            />
            ${blog.featured ? `<span class="absolute top-4 left-4 bg-yellow-400 text-blue-900 px-3 py-1 rounded-full text-xs font-bold shadow-lg">Featured</span>` : ''}
          </div>
          <div class="flex-1 flex flex-col px-5 pt-4 pb-5">
            <div class="flex items-center gap-2 mb-3">
              <img src="${blog.authorAvatar}" alt="${blog.author}" class="w-8 h-8 rounded-full border-2 border-yellow-300 object-cover bg-white" loading="lazy" />
              <span class="font-semibold text-blue-900 text-sm mr-2">${blog.author}</span>
              <span class="text-xs text-gray-400">&bull; ${blog.date}</span>
              <span class="ml-auto bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold">${blog.category}</span>
            </div>
            <h3 class="font-bold text-blue-900 text-xl mb-1 transition-colors group-hover:text-yellow-600">${blog.title}</h3>
            <p class="text-gray-600 mb-3 line-clamp-3 text-sm">${blog.summary}</p>
            <div class="flex gap-4 items-center text-xs text-gray-500 mb-4 mt-auto">
              <span title="Views">👁️ <span id="read-count-${blog.id}">${blog.reads}</span></span>
              <span title="Rating">⭐ ${blog.rating}</span>
              <span title="Comments">💬 ${blog.comments}</span>
            </div>
            <button 
              onclick="onReadAndEarn('${blog.id}')"
              class="w-full bg-yellow-500 text-blue-900 px-4 py-2 rounded-lg font-bold hover:bg-blue-900 hover:text-yellow-400 transition mt-auto focus:outline-none focus:ring-2 focus:ring-yellow-300"
              aria-label="Read full blog post by ${blog.author}">
              Read & Earn
            </button>
          </div>
        </div>
        `;
      }).join('');
    }

    async function incrementReadCount(postId) {
      try {
        await fetch(`https://examguide.onrender.com/api/blogger-dashboard/increment-views/${postId}`, {
          method: "PATCH"
        });
      } catch {}
    }

    async function onReadAndEarn(postId) {
      const countSpan = document.getElementById('read-count-' + postId);
      if (countSpan) {
        let num = parseInt(countSpan.textContent, 10);
        if (!isNaN(num)) countSpan.textContent = num + 1;
      }
      await incrementReadCount(postId);
      window.location = `campus-news-update?id=${postId}`;
    }

    window.onReadAndEarn = onReadAndEarn;

    fetchAndRenderBlogs();

    // === MARKETPLACE FETCH (using gen-marketplace.html logic) ===
    const BACKEND = "https://examguide.onrender.com";
    let marketItems = [];
    let filteredItems = [];
    const wishlist = new Set();

    // Fetch all published/active items from all sellers
    async function fetchAllListings() {
      try {
        const res = await fetch(BACKEND + "/api/marketplace/listings-public");
        if (!res.ok) throw new Error("Could not fetch listings");
        const data = await res.json();
        // Normalizing results for UI compatibility
        marketItems = (data || []).map(item => ({
          id: item._id || item.id,
          title: item.title || item.item,
          price: item.price,
          category: item.category || "Others",
          description: item.description || "",
          image: item.img || item.imageUrl || "https://placehold.co/400x300?text=No+Image",
          seller: item.sellerName || item.seller || "Unknown",
          verified: item.verified || false,
          rating: item.rating || (4 + Math.random()),
          reviews: item.reviews || Math.floor(Math.random() * 10) + 1,
          date: item.date || "Recently"
        }));
        filteredItems = [...marketItems];
        renderMarket(filteredItems);
      } catch (err) {
        document.getElementById('marketItemsGrid').innerHTML = "<div class='col-span-2 text-center text-red-500 py-10'>Failed to load marketplace items. Please try again later.</div>";
        document.getElementById('listingCount').textContent = "";
      }
    }

    // RENDER MARKETPLACE ITEMS
    function renderMarket(items) {
      const grid = document.getElementById('marketItemsGrid');
      if (!grid) return;
      grid.innerHTML = "";
      if (items.length === 0) {
        grid.innerHTML = "<div class='col-span-2 text-center text-gray-500 py-10'>No items found for your search or filter.</div>";
      }
      items.slice(0, 6).forEach(item => {
        grid.innerHTML += `
        <div class="bg-white rounded-xl shadow p-4 flex flex-col hover:shadow-xl transition group relative">
          <button onclick="toggleWishlist('${item.id}')" aria-label="Save to Wishlist" class="absolute top-3 right-3 text-2xl focus:outline-none transition">
            <span class="${wishlist.has(item.id) ? 'text-yellow-500' : 'text-gray-300'}">&#10084;</span>
          </button>
          <img src="${item.image}" alt="${item.title}" class="h-48 w-full object-cover rounded-lg mb-3 group-hover:scale-105 transition" />
          <div class="flex-1 flex flex-col">
            <h3 class="font-bold text-blue-900 text-lg mb-1">${item.title}</h3>
            <div class="flex items-center text-yellow-500 text-base font-bold mb-2">₦${(item.price||0).toLocaleString()}</div>
            <div class="text-xs text-gray-400 mb-1">${item.category} &bull; ${item.date}</div>
            <div class="flex flex-wrap gap-2 mb-2 items-center">
              <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs flex items-center gap-1">${item.seller} 
                ${item.verified ? '<span class="ml-1 inline-block bg-blue-900 text-yellow-400 px-2 rounded-full text-xs font-bold">Verified</span>' : ''}
              </span>
              <span class="bg-blue-900 text-white px-2 py-1 rounded text-xs"><span class="font-bold">${item.rating.toFixed(1)}</span> <span class="text-yellow-400">★</span> (${item.reviews})</span>
            </div>
            <p class="text-gray-600 mb-3 line-clamp-2">${item.description}</p>
            <div class="flex gap-2 flex-wrap">
              <a href="#" class="mt-auto bg-yellow-500 text-blue-900 px-3 py-2 rounded-lg font-bold hover:bg-blue-900 hover:text-yellow-400 transition">View & Chat</a>
            </div>
          </div>
        </div>
        `;
      });
      // Update listing count
      document.getElementById('listingCount').textContent = `${items.length} listing${items.length !== 1 ? 's' : ''} shown`;
    }

    function toggleWishlist(id) {
      if (wishlist.has(id)) wishlist.delete(id); else wishlist.add(id);
      renderMarket(filteredItems);
    }

    fetchAllListings();
  </script>
</body>
</html>
